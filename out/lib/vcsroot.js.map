{"version":3,"sources":["../../src/lib/vcsroot.js"],"names":["VcsRoot","baseUrl","name","password","_baseUrl","args","uri","options","_createRequestJson","get","vcsRootName","vcsRoot","isNothing","newProperties","_createPropertyRequests","existingProperties","differenceWith","x","y","properties","concat","_put","property","request","projectLocator","projectName","projectId","value","url","vcsName","vcsType","branch","push"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;;;;;;;;;;;IAEqBA,O;;;AAEnB;;;AAGA,mBAAaC,OAAb,EAAsBC,IAAtB,EAA4BC,QAA5B,EAAsC;AAAA;;AAAA,kHAC9BF,OAD8B,EACrBC,IADqB,EACfC,QADe;;AAEpC,UAAKC,QAAL,GAAmB,MAAKA,QAAxB;AAFoC;AAGrC;;AAED;;;;;;;;;4EAIWC,I;;;;;;8HACe,EAAEC,KAAQ,KAAKF,QAAb,aAA6BC,KAAKH,IAApC,E;;;;;;;;;;;;;;;;;;;;AAG1B;;;;;;;;;;;;;8EAScK,O;;;;;;+HACa,EAAED,KAAK,KAAKF,QAAZ,E,EAAwB,KAAKI,kBAAL,CAAwBD,OAAxB,C;;;;;;;;;;;;;;;;;;;;;;8EAGrCF,I;;;;;;iIACe,EAAEC,KAAQ,KAAKF,QAAb,aAA6BC,KAAKH,IAApC,E;;;;;;;;;;;;;;;;;;;;AAG7B;;;;;;;;;8EAKqBG,I;;;;;;;uBACG,KAAKI,GAAL,CAAS,EAAEP,MAAMG,KAAKK,WAAb,EAAT,C;;;AAAhBC,uB;;oBAEDA,QAAQC,S;;;;;AACLC,6B,GAAgB,KAAKC,uBAAL,CAA6BT,IAA7B,C;AAChBU,kC,GAAqB,gBAAEC,cAAF,CAAiB,UAACC,CAAD,EAAIC,CAAJ,EAAU;AAAED,oBAAEf,IAAF,KAAWgB,EAAEhB,IAAb;AAAoB,iBAAjD,EAAmDS,QAAQF,GAAR,GAAcU,UAAjE,EAA6EN,aAA7E,C;AACrBM,0B,GAAaJ,mBAAmBK,MAAnB,CAA0BP,aAA1B,C;;uBAEN,KAAKQ,IAAL,CAAU,EAACf,KAAQ,KAAKF,QAAb,aAA6BC,KAAKK,WAAlC,gBAAD,EAAV,EAAwE,EAAEY,UAAUH,UAAZ,EAAxE,C;;;;;;;;;;;;;;;;;;;;;uCAIGd,I,EAAM;AACxB,UAAIkB,UAAU;AACZrB,cAAMG,KAAKH,IADC;AAEZsB,wBAAgBnB,KAAKoB,WAAL,aACUpB,KAAKoB,WADf,WAEQpB,KAAKqB,SAJjB;AAKZP,oBAAY;AACVG,oBAAU,CACR,EAAEpB,MAAM,KAAR,EAAeyB,OAAOtB,KAAKuB,GAA3B,EADQ;AADA,SALA;AAUZC,iBAASxB,KAAKyB;AAVF,OAAd;;AAaA,UAAIzB,KAAK0B,MAAT,EAAiB;AACfR,gBAAQJ,UAAR,CAAmBG,QAAnB,CAA4BU,IAA5B,CAAiC,EAAE9B,MAAM,QAAR,EAAkByB,OAAOtB,KAAK0B,MAA9B,EAAjC;AACD;;AAED,aAAOR,OAAP;AACD;;;4CAEwBlB,I,EAAM;AAC7B,UAAIc,aAAa,EAAjB;AACA,WAAK,IAAIG,QAAT,IAAqBjB,KAAKc,UAA1B,EAAsC;AACpCA,mBAAWa,IAAX,CAAgB,EAAC9B,MAAMoB,QAAP,EAAiBK,OAAOtB,KAAKc,UAAL,CAAgBG,QAAhB,CAAxB,EAAhB;AACD;;AAED,aAAOH,UAAP;AACD;;;;;;kBAhFkBnB,O","file":"vcsroot.js","sourcesContent":["import Client from './client';\nimport R from 'ramda';\n\nexport default class VcsRoot extends Client {\n\n  /**\n   * @constructor\n   */\n  constructor (baseUrl, name, password) {\n    super(baseUrl, name, password);\n    this._baseUrl = `${this._baseUrl}/vcs-roots/`;\n  }\n\n  /**\n   * Get the vcs root that matches the name provided\n   * @param {string} args.name - the name of the vcs root to look for\n   */\n  async get (args) {\n    return await super._get({ uri: `${this._baseUrl}name:${args.name}` });\n  }\n\n  /**\n   * Create the request to send to teamcity\n   * @param {string} options.name - (Required) the name of the Vcs Root to create\n   * @param {string} options.projectName - the name of the project the VcsRoot will belong to\n   * @param {string} options.projectId - the name of the project the VcsRoot will belong to\n   * @param {string} options.url - (Required) the url to the repository to use for the vcs root\n   * @param {string} options.branch - the main branch to use for the repository\n   * @param {string} options.vcsType - (Required) the type of vcs connector to use [jetbrains.get|perforce|svn|tfs]\n   */\n  async create (options) {\n    return await super._post({ uri: this._baseUrl }, this._createRequestJson(options));\n  }\n\n  async delete (args) {\n    return await super._delete({ uri: `${this._baseUrl}name:${args.name}` });\n  }\n\n  /**\n   * @param {string} args.vcsRootName - the name of the vcsroot\n   * @param {object} args.properties - (Required) the object defining the properties to be set\n   *                                   {name1: value1, name2: value2}\n   */\n  async addProperties (args) {\n    const vcsRoot = await this.get({ name: args.vcsRootName });\n\n    if (!vcsRoot.isNothing) {\n      const newProperties = this._createPropertyRequests(args);\n      const existingProperties = R.differenceWith((x, y) => { x.name === y.name; }, vcsRoot.get().properties, newProperties);\n      const properties = existingProperties.concat(newProperties);\n\n      return await this._put({uri: `${this._baseUrl}name:${args.vcsRootName}/properties`}, { property: properties });\n    }\n  }\n\n  _createRequestJson (args) {\n    var request = {\n      name: args.name,\n      projectLocator: args.projectName\n                      ? `name:${args.projectName}`\n                      : `id:${args.projectId}`,\n      properties: {\n        property: [\n          { name: 'url', value: args.url }\n        ]\n      },\n      vcsName: args.vcsType\n    };\n\n    if (args.branch) {\n      request.properties.property.push({ name: 'branch', value: args.branch });\n    }\n\n    return request;\n  }\n\n  _createPropertyRequests (args) {\n    let properties = [];\n    for (let property in args.properties) {\n      properties.push({name: property, value: args.properties[property]});\n    }\n\n    return properties;\n  }\n}\n"]}